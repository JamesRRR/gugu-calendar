<view class="event-container">
  <!-- äº‹ä»¶å¡ç‰‡ -->
  <view class="event-card">
    <view class="event-title">{{event.title}}</view>
    
    <!-- æ·»åŠ æ´»åŠ¨çŠ¶æ€æç¤º -->
    <view class="cancelled-tip" wx:if="{{event.status === 'cancelled'}}">
      æ­¤æ´»åŠ¨å·²å–æ¶ˆ
    </view>
    
    <!-- åŸºæœ¬ä¿¡æ¯åŒºåŸŸ -->
    <view class="info-section">
      <view class="info-item">
        <text class="icon">ğŸ•’</text>
        <text>{{formattedStartTime}}</text>
      </view>
      <view class="info-item" wx:if="{{formattedEndTime}}">
        <text class="icon">â°</text>
        <text>{{formattedEndTime}}</text>
      </view>
      <view class="info-item">
        <text class="icon">ğŸ“</text>
        <text>{{(event.location && event.location.name) ? event.location.name : 'åœ°ç‚¹æœªå¡«å†™'}}</text>
      </view>
      <view class="info-item">
        <text class="icon">ğŸ‘¥</text>
        <text>{{event.participants.length}}{{event.maxParticipants ? '/' + event.maxParticipants : ''}} äººå‚åŠ </text>
      </view>
    </view>

    <!-- è¯¦ç»†æè¿° -->
    <view class="description-section">
      <text class="description-title">æ´»åŠ¨è¯¦æƒ…</text>
      <text class="description-content">{{event.description}}</text>
    </view>

    <!-- æ”¶æ¬¾æ¨¡å¼ï¼šæ˜¾ç¤ºä»˜æ¬¾äºŒç»´ç æˆ–æ¨¡æ‹Ÿä»˜æ¬¾ -->
    <view class="payment-section" wx:if="{{event.mode === 'payment'}}">
      <view class="section-title">ä»˜æ¬¾ä¿¡æ¯</view>
      <view class="payment-info">
        <view class="payment-amount">
          <text class="amount-label">åº”ä»˜é‡‘é¢ï¼š</text>
          <text class="amount-value">Â¥{{event.paymentAmount}}</text>
        </view>
        
        <!-- æ¨¡æ‹Ÿæ”¯ä»˜æ¨¡å¼ -->
        <view class="mock-payment" wx:if="{{isMockPayment}}">
          <view class="mock-badge">ğŸ§ª æ¨¡æ‹Ÿæ”¯ä»˜</view>
          <view class="mock-status" wx:if="{{hasMockPaid}}">
            <text class="mock-success">âœ… æ¨¡æ‹Ÿæ”¯ä»˜å·²å®Œæˆ</text>
          </view>
          <view class="mock-status" wx:else>
            <text class="mock-pending">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å®Œæˆæ¨¡æ‹Ÿæ”¯ä»˜</text>
            <button class="mock-pay-btn" bindtap="mockPayment">æ¨¡æ‹Ÿä»˜æ¬¾</button>
          </view>
        </view>
        
        <!-- æ­£å¸¸äºŒç»´ç æ”¯ä»˜ -->
        <view class="payment-qrcode" wx:if="{{!isMockPayment && paymentQrcodeUrl}}">
          <image class="qrcode-image" src="{{paymentQrcodeUrl}}" mode="aspectFit"></image>
          <text class="qrcode-tip">é•¿æŒ‰è¯†åˆ«ä»˜æ¬¾</text>
        </view>
        <view class="payment-link" wx:if="{{!isMockPayment && paymentLink}}">
          <text class="link-label">ä»˜æ¬¾é“¾æ¥ï¼š</text>
          <text class="link-url" selectable="true">{{paymentLink}}</text>
        </view>
      </view>
    </view>

    <!-- å‚ä¸è€…åˆ—è¡¨ -->
    <view class="participants-section">
      <text class="section-title">å‚ä¸è€…</text>
      <view class="participants-list">
        <view class="participant-item" wx:for="{{participants}}" wx:key="_openid">
          <image
            wx:if="{{item.avatarUrl}}"
            class="avatar"
            src="{{item.avatarUrl}}"
            mode="aspectFill"
          />
          <view wx:else class="avatar avatar-placeholder">ğŸ‘¤</view>
          <text class="nickname">{{item.nickName || 'åŒ¿åç”¨æˆ·'}}</text>
          <text class="creator-tag" wx:if="{{item._openid === event.creator}}">åˆ›å»ºè€…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <!-- åˆ†äº«æŒ‰é’® - æ‰€æœ‰äººå¯è§ -->
    <button 
      class="action-btn share-btn" 
      open-type="share">
      <text class="icon">ğŸ“¢</text>
      <text>åˆ†äº«</text>
    </button>

    <!-- æœªå‚åŠ æ—¶æ˜¾ç¤ºåŠ å…¥æŒ‰é’® -->
    <button 
      class="action-btn join-btn" 
      wx:if="{{!hasJoined && event.status !== 'cancelled'}}"
      bindtap="joinEvent">
      <text class="icon">âœ…</text>
      <text>åŠ å…¥</text>
    </button>

    <!-- å·²å‚åŠ æ—¶æ˜¾ç¤ºé€€å‡ºå’Œå’•å’•æŒ‰é’® -->
    <block wx:if="{{hasJoined}}">
      <button 
        class="action-btn quit-btn" 
        bindtap="quitEvent"
        disabled="{{event.status === 'cancelled'}}"
        wx:if="{{event.status !== 'cancelled'}}">
        <text class="icon">ğŸšª</text>
        <text>é€€å‡º</text>
      </button>

      <button 
        class="action-btn gugu-btn" 
        bindtap="onRegret"
        disabled="{{event.status === 'gugu' || event.status === 'cancelled'}}"
        wx:if="{{event.status !== 'cancelled'}}">
        <text class="icon">ğŸ•Šï¸</text>
        <text>{{event.status === 'gugu' ? 'å·²å’•å’•' : 'å’•å’•'}}</text>
      </button>
    </block>
  </view>

  <!-- æˆæƒæµ®å±‚ï¼šå¿…é¡»ç”±ç”¨æˆ·ç‚¹å‡»è§¦å‘æˆæƒ -->
  <view wx:if="{{needProfile}}" class="auth-overlay">
    <view class="auth-card">
      <view class="auth-title">éœ€è¦æˆæƒ</view>
      <view class="auth-desc">{{needProfileMessage}}</view>
      <input
        type="nickname"
        class="auth-nickname"
        placeholder="è¯·è¾“å…¥æ˜µç§°ï¼ˆç”¨äºæ´»åŠ¨å‚ä¸è€…å±•ç¤ºï¼‰"
        value="{{profileNickName}}"
        bindchange="onProfileNickNameChange"
      />
      <button class="auth-btn" bindtap="authorizeAndJoin">å»æˆæƒå¹¶åŠ å…¥</button>
      <button class="auth-cancel" bindtap="closeNeedProfile">å–æ¶ˆ</button>
    </view>
  </view>
</view> 